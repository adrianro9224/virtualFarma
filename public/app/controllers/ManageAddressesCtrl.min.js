/**
 * Created by Adrian on 14/08/2015.
 */
farmapp.controller("ManageAddressesCtrl",["$scope","$http","$rootScope","ConstantsService",function(s,t,e,a){"use strict";function n(s,t){var e={id:t.id,from:t.from,address_line:s.line1,name:s.name};return e}function o(){s.buttonDeleteText=s.deletingAddress?"Borrando":"Borrar"}function d(){s.buttonUpdateText=s.updatingAddress?"Actualizando":"Actualizar"}function r(){s.buttonText=s.savingAddress?"Guardando":"Guardar"}function i(){s.loadingAddresses=!0,t.get("http://virtualfarma.com.co/address/get_all").success(function(t){s.loadingAddresses=!1;var e=angular.fromJson(t);"CHARGED"==e.status&&(s.addressesCharged=!0,s.addresses=angular.fromJson(e.addresses),console.info(s.addresses)),"EMPTY"==e.status&&(s.addressesEmpty=!0),"SESSION_EXPIRED"==e.status&&(window.location="/account")}).error(function(s){console.info(s+":(")})}s.savingAddress=!1,s.panelDirty=!1,s.loadingAddresses=!1,s.addressesCharged=!1,s.updatingAddress=!1,s.deletingAddress=!1,s.addressesEmpty=!1,r(),d(),o(),e.$on(a.CHARGE_EVERY_USER_ADDRESSES,function(){i()}),s.saveAddress=function(e){s.savingAddress=!0,s.panelDirty=!0,s.infoStatusText="Cargando ...",r(),t.post("http://virtualfarma.com.co/address/create_address",{data:e}).success(function(t){s.savingAddress=!1,r(),"SAVED"==t&&(s.infoStatusText="Tu dirección a sido agregada!",i()),"RETRY"==t&&(s.infoStatusText="Por favor intentalo de nuevo!"),"SESSION_EXPIRED"==t&&(window.location="/account"),console.info(t)}).error(function(s){console.info(s+":(")})},s.updateAddress=function(e,a){var o=n(e,a);s.panelDirty=!0,s.updatingAddress=!0,s.infoStatusText="Actualizando!",t.post("http://virtualfarma.com.co/address/update_address",{data:o}).success(function(t){s.updatingAddress=!1,d(),"UPDATED"==t&&(s.infoStatusText="Tu dirección a sido actualizada!",i()),"RETRY"==t&&(s.infoStatusText="Por favor intentalo de nuevo!"),"SESSION_EXPIRED"==t&&(window.location="/account")}).error(function(s){console.info(s+":(")})},s.deleteAddress=function(e){s.panelDirty=!0,s.deletingAddress=!0,s.infoStatusText="Borrando!",t.post("http://virtualfarma.com.co/address/delete_address",{data:e}).success(function(t){s.deletingAddress=!1,o(),"DELETED"==t&&(s.infoStatusText="Tu dirección a sido borrada!",i()),"RETRY"==t&&(s.infoStatusText="Por favor intentalo de nuevo!"),"SESSION_EXPIRED"==t&&(window.location="/account")}).error(function(s){console.info(s+":(")})}}]);
