farmapp.controller("ShoppingCartCtrl",["$scope","$rootScope","$log","$cookies","$http","$window","ConstantsService",function(t,p,a,o,r,i,s){"use strict";function n(t){var p=0,a=0;angular.forEach(t,function(t){p+=t.price*t.cant,a+=t.tax*t.price});var o={productsSubtotal:p,productsTaxTotal:a};return o}function c(t){var p;return p=t>=s.LIMIT_FOR_FREE_SHIPPING?"Es gratis":s.SHIPPING_CHARGE}var g=new Date,h=g.getDate();g.setDate(h+3);var u={path:"/",expires:g};t.subtotal=0,t.tax=0,t.total=0,t.limitOrderValueInvalid=!1;var e=s.LIMIT_PAYU_ORDER_VALUE,l=s.MINIMUM_ORDER_VALUE,d=s.LIMIT_FOR_FREE_SHIPPING;p.$on(s.SHOPPINGCART_CHANGED,function(p,a){if(t.shoppingcart=a,t.shoppingcart.haveProducts){var r;r=n(t.shoppingcart.products),t.shoppingcart.subtotal=r.productsSubtotal,t.shoppingcart.tax=r.productsTaxTotal;var i=t.shoppingcart.subtotal;t.shoppingcart.hasDiscount&&(t.shoppingcart.subtotal-=t.shoppingcart.pointsDoDiscount,i+=t.shoppingcart.pointsDoDiscount);var s=c(i);console.info(t.shoppingcart),t.shoppingcart.shippingCharge=s,angular.isString(s)?(t.shoppingcart.total=t.shoppingcart.subtotal+t.shoppingcart.tax,t.shoppingcart.shippingFree=!0):(t.shoppingcart.total=t.shoppingcart.subtotal+t.shoppingcart.tax+t.shoppingcart.shippingCharge,t.shoppingcart.shippingFree=!1),t.shippingCharge=t.shoppingcart.shippingCharge,t.subtotal=t.shoppingcart.subtotal,void 0!=l&&(t.shoppingcart.minimumOrderValue=l,t.shoppingcart.minimumOrderValueInvalid=t.shoppingcart.subtotal<l?!0:!1),void 0!=e&&(t.shoppingcart.limitOrderValueInvalid=t.shoppingcart.total>e?!0:!1),void 0!=d&&(t.shoppingcart.limitForFreeShipping=d),t.total=t.shoppingcart.total,o.putObject("shoppingcart",t.shoppingcart,u)}else o.remove("shoppingcart",u)});var v=o.getObject("shoppingcart");void 0!=v&&(t.shoppingcart=v,t.subtotal=t.shoppingcart.subtotal,t.shippingCharge=t.shoppingcart.shippingCharge,t.tax=t.shoppingcart.tax,t.total=t.shoppingcart.total),t.removeProduct=function(a){t.shoppingcart.products[a].cant>1?(t.shoppingcart.products[a].cant--,t.shoppingcart.numOfproductsTotal--):(t.shoppingcart.products.splice(a,1),t.shoppingcart.numOfproductsTotal--,t.shoppingcart.numOfproductsSubtotal--),0==t.shoppingcart.numOfproductsTotal&&(t.shoppingcart.haveProducts=!1),p.$broadcast(s.SHOPPINGCART_CHANGED,t.shoppingcart)}}]);